<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherSphere</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="bgCanvas" aria-hidden="true"></canvas>

    <!-- Error Toast -->
    <div id="errorToast" class="error-toast hidden" role="alert">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <span id="errorMsg">Error</span>
        <button class="toast-close" onclick="this.closest('.error-toast').classList.add('hidden')">‚úï</button>
    </div>

    <!-- Location tracking banner -->
    <div id="trackBanner" class="track-banner hidden">
        <span class="track-pulse"></span>
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="22"/><line x1="2" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="22" y2="12"/></svg>
        <span id="trackText">Tracking your location</span>
        <button id="stopTrack" class="track-stop">Stop</button>
    </div>

    <!-- HEADER -->
    <header class="app-header">
        <div class="brand">
            <div class="app-logo">
                <svg id="morphIcon" viewBox="0 0 36 36" fill="none">
                    <g id="sunGroup">
                        <circle cx="18" cy="18" r="7" fill="white" id="sunCore"/>
                        <g id="sunRays" stroke="white" stroke-width="2" stroke-linecap="round">
                            <line x1="18" y1="3" x2="18" y2="7"/><line x1="18" y1="29" x2="18" y2="33"/>
                            <line x1="3" y1="18" x2="7" y2="18"/><line x1="29" y1="18" x2="33" y2="18"/>
                            <line x1="7.1" y1="7.1" x2="9.9" y2="9.9"/><line x1="26.1" y1="26.1" x2="28.9" y2="28.9"/>
                            <line x1="7.1" y1="28.9" x2="9.9" y2="26.1"/><line x1="26.1" y1="9.9" x2="28.9" y2="7.1"/>
                        </g>
                    </g>
                    <g id="cloudGroup" opacity="0">
                        <path d="M8 22 Q6 18 10 16 Q10 10 16 10 Q20 6 26 10 Q30 10 30 15 Q33 15 33 19 Q33 23 29 23 Z" fill="white" opacity="0.9"/>
                    </g>
                </svg>
            </div>
            <div class="brand-text">
                <div class="app-name">WeatherSphere</div>
                <div class="app-tag">Live ¬∑ Smooth ¬∑ Beautiful</div>
            </div>
        </div>

        <div class="header-search">
            <div class="search-wrap">
                <svg class="s-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" id="searchInput" placeholder="Search any city‚Ä¶" autocomplete="off" spellcheck="false">
            </div>
            <button id="searchBtn" class="btn-primary">Search</button>
        </div>

        <div class="header-right">
            <div class="recent-chips" id="recentChips"></div>
            <div class="hdr-btns">
                <button id="unitToggle" class="hdr-btn" title="Toggle ¬∞C/¬∞F">¬∞C</button>
                <button id="themeToggle" class="hdr-btn" title="Toggle theme">
                    <svg id="themeIcon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </button>
                <button id="locateBtn" class="hdr-btn locate-btn" title="Use my location">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="22"/><line x1="2" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="22" y2="12"/></svg>
                </button>
                <button id="trackBtn" class="hdr-btn track-btn" title="Live location tracking">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="main-layout">
        <!-- LEFT -->
        <div class="left-col">

            <!-- Fav bar -->
            <div id="favSection" class="fav-bar hidden">
                <span class="fav-label">‚≠ê Saved</span>
                <div class="fav-chips" id="favChips"></div>
            </div>

            <!-- Hero weather card -->
            <div class="card hero-card" id="heroCard">
                <div class="hero-top">
                    <div class="hero-location">
                        <h2 id="locationName">Loading‚Ä¶</h2>
                        <div id="updatedAt" class="updated-at">‚Äî</div>
                    </div>
                    <button id="favBtn" class="fav-star" title="Favourite">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    </button>
                </div>

                <div class="hero-main">
                    <div class="weather-icon-wrap">
                        <img id="currentIcon" src="" alt="weather" class="weather-icon">
                        <div class="icon-glow" id="iconGlow"></div>
                    </div>
                    <div class="hero-temp-block">
                        <div id="currentTemp" class="big-temp">--¬∞</div>
                        <div id="currentCondition" class="condition-text">--</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-cell">
                        <div class="stat-icon">üå°Ô∏è</div>
                        <div class="stat-label">Feels Like</div>
                        <div id="feelsLike" class="stat-val">--¬∞</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üíß</div>
                        <div class="stat-label">Humidity</div>
                        <div id="humidity" class="stat-val">--%</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üí®</div>
                        <div class="stat-label">Wind</div>
                        <div id="windSpeed" class="stat-val">--</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üß≠</div>
                        <div class="stat-label">Direction</div>
                        <div id="windDir" class="stat-val">--</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-label">Pressure</div>
                        <div id="pressure" class="stat-val">--</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üëÅÔ∏è</div>
                        <div class="stat-label">Visibility</div>
                        <div id="visibility" class="stat-val">--</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üåÖ</div>
                        <div class="stat-label">Sunrise</div>
                        <div id="sunrise" class="stat-val">--:--</div>
                    </div>
                    <div class="stat-cell">
                        <div class="stat-icon">üåá</div>
                        <div class="stat-label">Sunset</div>
                        <div id="sunset" class="stat-val">--:--</div>
                    </div>
                </div>
            </div>

            <!-- UV + AQI -->
            <div class="two-col-row">
                <div class="card uv-card">
                    <div class="card-label">‚òÄÔ∏è UV INDEX</div>
                    <div id="uvValue" class="card-big-num">--</div>
                    <div id="uvLabel" class="card-sub-label">--</div>
                    <div class="uv-track"><div id="uvFill" class="uv-fill"></div></div>
                    <div class="uv-scale">
                        <span>Low</span><span>Mod</span><span>High</span><span>V.High</span><span>Ext</span>
                    </div>
                </div>
                <div class="card aqi-card">
                    <div class="card-label">üå¨Ô∏è AIR QUALITY</div>
                    <div id="aqiValue" class="card-big-num">--</div>
                    <div id="aqiLabel" class="card-sub-label">--</div>
                    <div class="aqi-pills">
                        <div class="aqi-pill">
                            <span class="pill-name">PM2.5</span>
                            <span id="pm25" class="pill-val">--</span>
                        </div>
                        <div class="aqi-pill">
                            <span class="pill-name">PM10</span>
                            <span id="pm10" class="pill-val">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hourly -->
            <div class="card">
                <div class="section-head">
                    <span>üïê NEXT 24 HOURS</span>
                </div>
                <div class="hourly-strip" id="hourlyContainer"></div>
            </div>

            <!-- 7-day -->
            <div class="card">
                <div class="section-head">
                    <span>üìÖ 7-DAY FORECAST</span>
                </div>
                <div class="forecast-list" id="dailyContainer"></div>
            </div>

            <!-- Precipitation chart -->
            <div class="card chart-card">
                <div class="section-head">
                    <span>üåßÔ∏è PRECIPITATION (7 DAYS)</span>
                    <span class="unit-badge">mm</span>
                </div>
                <div class="chart-area">
                    <canvas id="precipChart"></canvas>
                </div>
            </div>

        </div>

        <!-- RIGHT -->
        <aside class="right-col">

            <!-- Map ‚Äî big and prominent -->
            <div class="card map-card">
                <div class="map-top">
                    <span class="map-title-label">üó∫Ô∏è LIVE MAP</span>
                    <span class="map-hint-text">Click anywhere for weather</span>
                </div>
                <div id="map"></div>
            </div>

            <!-- Insights -->
            <div class="card insights-card">
                <div class="section-head">‚ö° WEATHER INSIGHTS</div>
                <div id="insightsList" class="insights-body">
                    <div class="insight-skeleton"></div>
                    <div class="insight-skeleton"></div>
                    <div class="insight-skeleton"></div>
                </div>
            </div>

            <!-- Temp range -->
            <div class="card range-card">
                <div class="section-head">üå°Ô∏è WEEKLY RANGE</div>
                <div id="tempRangeList" class="range-body"></div>
            </div>

        </aside>
    </main>

    <footer class="app-footer">
        <div class="footer-inner">
            <span>‚õÖ <strong>WeatherSphere</strong></span>
            <span class="footer-sep">|</span>
            <span>Data: <a href="https://open-meteo.com" target="_blank">Open-Meteo</a></span>
            <span>¬∑</span>
            <span>Geo: <a href="https://opencagedata.com" target="_blank">OpenCage</a></span>
            <span>¬∑</span>
            <span>Map: <a href="https://leafletjs.com" target="_blank">Leaflet</a> + CARTO</span>
            <span class="footer-sep">|</span>
            <span id="footerClock" class="footer-clock"></span>
        </div>
    </footer>

    <div id="loading" class="loading-veil hidden">
        <div class="spinner-ring"><div></div><div></div><div></div></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>